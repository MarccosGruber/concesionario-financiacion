<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Solicitar financiaci√≥n</title>

<style>
body{margin:0;font-family:Inter,system-ui;background:#fff;color:#111;}
header{
  position:fixed;top:0;width:100%;background:#fff;border-bottom:1px solid #eee;
  padding:14px 20px;z-index:1000;display:flex;justify-content:center;
}
header .brand{font-size:20px;font-weight:700;}

.container{max-width:1200px;margin:0 auto;padding:80px 20px;}

h1{text-align:center;font-size:30px;margin-bottom:6px;}
.subtitle{text-align:center;color:#666;margin-bottom:28px;}

.steps{display:flex;gap:10px;justify-content:center;margin-bottom:26px;}
.step{
  padding:6px 16px;border-radius:999px;border:1px solid #ddd;background:#f5f5f5;
  font-size:14px;cursor:pointer;
}
.step.active{background:#111;color:white;border-color:#111;}

/* Subcategor√≠as */
.filters{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  justify-content:center;
  margin-bottom:20px;
}

.chip{
  padding:6px 18px;
  border-radius:999px;
  border:1px solid #ddd;
  background:#f8f8f8;
  cursor:pointer;
  font-size:13px;
  display:inline-block;
  width:auto;
  white-space:nowrap;
  transition:0.5s;
  color:#252525;
}
.chip:hover{background:#000;color:#fff;}
.chip.active{background:#111;color:#fff;border-color:#111;}

/* Grid motos */
/* GRID DE MOTOS ‚Äî 3 por fila en PC, 1 en m√≥vil */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 26px;
  justify-items: center;
}

/* TARJETA DE MOTO */
.card {
  width: 100%;
  max-width: 580px;   /* EXACTO para tus im√°genes */
  border: 1px solid #eee;
  border-radius: 16px;
  overflow: hidden;
  cursor: pointer;
  background: #fff;
  transition: 0.25s;
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.08);
}

/* IMAGEN */
.card img {
  width: 100%;
  height: 300px;
  object-fit: contain;
  background: white;     /* asegura fondo limpio */
  padding: 10px;         /* evita que toque los bordes */
  display: block;
}

/* TEXTO */
.card h3 {
  margin: 30px;
  font-size: 18px;
  text-align: center;
}

@media (max-width: 768px) {
  .grid {
    grid-template-columns: 1fr; /* SOLO UNA POR FILA EN CELULAR */
  }

  .card {
    max-width: 100%;
  }

  .card img {
    height: 260px;  /* m√°s proporcional en pantalla peque√±a */
  }
}

/* Formulario */
.form-box{
  border:1px solid #eee;
  padding:24px;
  border-radius:12px;
  max-width:480px;
  margin:0 auto;
  display:none;
  background:white;
  box-shadow:0px 4px 20px rgba(0,0,0,0.06);
}

.moto-resumen{
  display:flex;
  gap:12px;
  border-bottom:1px solid #ddd;
  padding-bottom:12px;
  margin-bottom:12px;
}

.moto-resumen img{
  width:110px;height:80px;object-fit:contain;border-radius:10px;background:white;padding:4px;
}

/* Inputs y botones */
input,button{
  width:100%;
  padding:12px;
  border-radius:8px;
  margin-bottom:14px;
  border:1px solid #ddd;
  background:#fafafa;
  font-size:14px;
  outline:none;
  transition:0.2s;
  box-sizing:border-box;
}

input:focus{
  border-color:#111;
  background:white;
  box-shadow:0 0 0 2px rgba(0,0,0,0.05);
}

button{
  background:#111;
  color:white;
  border:none;
  font-weight:600;
}

/* Consentimiento */
.consent{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:13px;
  margin-top:4px;
  margin-bottom:10px;
}

.consent input{
  width:auto;
  margin-bottom:0;
}

/* Mensajes */
.ok{
  display:none;background:#d1fae5;color:#065f46;padding:10px;
  border-radius:8px;margin-top:10px;font-size:14px;text-align:center;
}
.err{
  display:none;background:#fee2e2;color:#b91c1c;padding:10px;
  border-radius:8px;margin-top:10px;font-size:14px;text-align:center;
}

/* Animaciones suaves para cambio de pasos */
.fade-in {
  opacity: 0;
  transform: translateY(15px);
  animation: fadeIn .45s forwards ease;
}

.fade-out {
  opacity: 1;
  transform: translateY(0);
  animation: fadeOut .35s forwards ease;
}

@keyframes fadeIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeOut {
  to {
    opacity: 0;
    transform: translateY(-15px);
  }
}
</style>
</head>
<body>

<header><div class="brand">Solicitar financiaci√≥n</div></header>

<div class="container">

  <h1>Solicitar financiaci√≥n</h1>
  <p class="subtitle">Eleg√≠ una moto y complet√° tus datos. Es r√°pido y sin compromiso.</p>

  <div class="steps">
    <div id="step1btn" class="step active">1 ‚Äî Elegir moto</div>
    <div id="step2btn" class="step">2 ‚Äî Datos personales</div>
  </div>

  <!-- Buscador -->
  <input 
    id="buscador"
    type="text"
    placeholder="Buscar modelo..."
    style="
      width:100%;
      max-width:420px;
      padding:10px 14px;
      margin:0 auto 20px auto;
      display:block;
      border-radius:999px;
      border:1px solid #ddd;
      font-size:15px;
      outline:none;
    ">

  <!-- Chips subcategor√≠as -->
  <div class="filters" id="subcats"></div>

  <!-- Paso 1 -->
  <div id="paso1">
    <div class="grid" id="vehiculos-grid"></div>
  </div>

  <!-- Paso 2 -->
  <div id="paso2" style="display:none;">
    <div class="form-box" id="formBox">

      <div id="motoResumen" class="moto-resumen"></div>

      <form id="form">

        <label>Nombre y apellido</label>
        <input id="nombre" type="text" required placeholder="...">

        <label>Tel√©fono (WhatsApp)</label>
        <input id="telefono" type="tel" required placeholder="+54...">

        <label>DNI</label>
        <input id="dni" type="number" required placeholder="...">

        <input type="hidden" id="vehiculo">
        <input type="hidden" id="precio">

        <label class="consent">
          <input type="checkbox" id="consentimiento" required>
          Acepto el uso de mis datos para gestionar la financiaci√≥n.
        </label>

        <button style="margin-top: 10px;" type="submit">Enviar solicitud</button>

        <div id="ok" class="ok">‚úÖ ¬°Solicitud enviada! Te llegar√° un WhatsApp.</div>
        <div id="err" class="err"></div>

      </form>

    </div>
  </div>

</div>

<script>
// REFERENCIAS
const paso1 = document.getElementById("paso1");
const paso2 = document.getElementById("paso2");
const formBox = document.getElementById("formBox");
const buscador = document.getElementById("buscador");
const subcatsContainer = document.getElementById("subcats");

let subcatSeleccionada = null;
let buscadorPrimero = false;
let subcatPrimero = false;


// GET categor√≠a desde la URL
const urlParams = new URLSearchParams(window.location.search);
const marca = urlParams.get("cat");

// BASE DE DATOS
const catalogo=[

  // HONDA

  // 110cc
  { nombre: "Honda Wave 110", categoria: "Honda", sub: ["110"], precio: 0, img: "./Motos/Honda Wave 110.jpg" },
  { nombre: "Honda Navi 110", categoria: "Honda", sub: ["110", "SCOOTERS"], precio: 0, img: "./Motos/Honda Navi 110.jpg" },

  // 125cc
  { nombre: "Honda Biz 125", categoria: "Honda", sub: ["125", "SCOOTERS"], precio: 0, img: "./Motos/Honda Biz 125.jpg" },

  // 150cc
  { nombre: "Honda CG Titan 150", categoria: "Honda", sub: ["150"], precio: 0, img: "./Motos/Honda CG Titan 150.jpg" },

  // On/off ‚Äî 150 / 160 / 190
  { nombre: "Honda XR 150L", categoria: "Honda", sub: ["150"], precio: 0, img: "./Motos/Honda XR 150L.jpg" },
  { nombre: "Honda XR 160 Tornado", categoria: "Honda", sub: ["160"], precio: 0, img: "./Motos/Honda XR 160 Tornado.jpg" },
  { nombre: "Honda XR 190L", categoria: "Honda", sub: ["190"], precio: 0, img: "./Motos/Honda XR 190L.jpg" },

  // Naked 160
  { nombre: "Honda CB160F", categoria: "Honda", sub: ["160"], precio: 0, img: "./Motos/Honda CB160F.jpg" },

  // 250
  { nombre: "Honda XR 250 Tornado", categoria: "Honda", sub: ["250"], precio: 0, img: "./Motos/Honda XR 250 Tornado.jpg" },
  { nombre: "Honda CB250 Twister", categoria: "Honda", sub: ["250"], precio: 0, img: "./Motos/Honda CB250 Twister.jpg" },

  // Scooters
  { nombre: "Honda PCX 160", categoria: "Honda", sub: ["SCOOTERS", "160"], precio: 0, img: "./Motos/Honda PCX 160.jpg" },
  { nombre: "Honda Elite 125", categoria: "Honda", sub: ["SCOOTERS", "125"], precio: 0, img: "./Motos/Honda Elite 125.jpg" },

  // 300
  { nombre: "Honda CB300F Twister", categoria: "Honda", sub: ["300"], precio: 0, img: "./Motos/Honda CB300F Twister.jpg" },
  { nombre: "Honda CBR300R", categoria: "Honda", sub: ["300"], precio: 0, img: "./Motos/Honda CBR300R.jpg" },

  // Adventure 300
  { nombre: "Honda XRE 300", categoria: "Honda", sub: ["300"], precio: 0, img: "./Motos/Honda XRE 300.jpg" },

  // Alta gama
  { nombre: "Honda CB500X", categoria: "Honda", sub: ["500"], precio: 0, img: "./Motos/Honda CB500X.jpg" },
  { nombre: "Honda NC750X", categoria: "Honda", sub: ["750"], precio: 0, img: "./Motos/Honda NC750X.jpg" },
  { nombre: "Honda Africa Twin 1100", categoria: "Honda", sub: ["1100"], precio: 0, img: "./Motos/Honda Africa Twin 1100.jpg" },
];

// ---------- SUBCATEGOR√çAS ----------
function renderSubcats(){
  const subcats = [
    ...new Set(
      catalogo
        .filter(m => m.categoria === marca)
        .flatMap(m => m.sub)
    )
  ];

  const chipsHtml = subcats.map(s => {
    const label = (s.toUpperCase() === "SCOOTER" || s.toUpperCase() === "SCOOTERS") ? "SCOOTERS" : s;
    return `<button class="chip" data-sub="${s}">${label}</button>`;
  }).join('');

  subcatsContainer.innerHTML =
    `<button class="chip active" data-sub="">Todas</button>` + chipsHtml;

  const chips = subcatsContainer.querySelectorAll(".chip");
  chips.forEach(chip => {
  chip.addEventListener("click", () => {
    chips.forEach(c => c.classList.remove("active"));
    chip.classList.add("active");

    const value = chip.getAttribute("data-sub");
    subcatSeleccionada = value ? value : null;

    subcatPrimero = true;
    buscadorPrimero = false;

    renderMotos();
  });
});
}

// ---------- LISTADO DE MOTOS (con buscador + filtro) ----------
function renderMotos() {
  const texto = buscador.value.toLowerCase().trim();

  // 1 ‚Äî BASE: filtrar solo por marca
  let lista = catalogo.filter(m => m.categoria === marca);

  // 2 ‚Äî L√ìGICA INTELIGENTE
  if (buscadorPrimero && subcatSeleccionada) {
    // üîµ Caso 1 ‚Üí se combinan
    lista = lista.filter(m =>
      m.nombre.toLowerCase().includes(texto) ||
      m.sub.some(s => s.toLowerCase().includes(texto))
    ).filter(m => m.sub.includes(subcatSeleccionada));

  } else if (subcatPrimero && texto.length > 0) {
    // üî¥ Caso 2 ‚Üí NO combinar
    lista = catalogo.filter(m => m.categoria === marca)
                    .filter(m =>
      m.nombre.toLowerCase().includes(texto) ||
      m.sub.some(s => s.toLowerCase().includes(texto))
    );

  } else {
    // üîò Caso normal: sin combinaciones especiales
    if (subcatSeleccionada) {
      lista = lista.filter(m => m.sub.includes(subcatSeleccionada));
    }
    if (texto.length > 0) {
      lista = lista.filter(m =>
        m.nombre.toLowerCase().includes(texto) ||
        m.sub.some(s => s.toLowerCase().includes(texto))
      );
    }
  }

  // 3 ‚Äî Render final
  document.getElementById("vehiculos-grid").innerHTML =
    lista.length === 0
      ? `<p style="text-align:center;color:#888;">No se encontraron modelos</p>`
      : lista.map(m => `
          <div class='card' onclick="seleccionarMoto('${m.nombre}')">
            <img src='${m.img}'>
            <h3>${m.nombre}</h3>
          </div>
        `).join('');
}

// ---------- PASO 2 ----------
function seleccionarMoto(nombre){
  const m = catalogo.find(x=>x.nombre===nombre);
  if (!m) return;

  // Animaci√≥n suave al ocultar paso 1
  paso1.classList.add("fade-out");

  setTimeout(() => {
    paso1.style.display = "none";
    paso1.classList.remove("fade-out");

    // Mostrar paso 2 con animaci√≥n
    paso2.style.display = "block";
    formBox.style.display = "block";
    paso2.classList.add("fade-in");

    // Actualizar pasos
    document.getElementById("step1btn").classList.remove("active");
    document.getElementById("step2btn").classList.add("active");

    // Scroll arriba
    window.scrollTo({ top: 0, behavior: "smooth" });

  }, 350);

  // Ocultar subcategor√≠as y buscador
  subcatsContainer.style.display = "none";
  document.getElementById("buscador").style.display = "none";


  // Completar datos ocultos
  document.getElementById("vehiculo").value = m.nombre;
  document.getElementById("precio").value = m.precio;

  // Resumen
  document.getElementById("motoResumen").innerHTML = `
    <img src="${m.img}" alt="${m.nombre}">
    <div><strong>${m.nombre}</strong></div>
  `;
}

// ---------- ENVIAR FORMULARIO ----------
document.getElementById("form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const rawTel = document.getElementById("telefono").value.trim();

  // Elimina todo lo que no sea n√∫mero
  const telefonoLimpio = rawTel.replace(/\D/g, "");

  // Asegura que empiece con 54
  let telefonoFinal = telefonoLimpio;
  if (!telefonoFinal.startsWith("54")) {
    telefonoFinal = "54" + telefonoFinal;
  }

  const data = {
    nombre: document.getElementById("nombre").value.trim(),
    telefono: telefonoFinal,
    dni: document.getElementById("dni").value.trim(),
    vehiculo: document.getElementById("vehiculo").value,
    precio: Number(document.getElementById("precio").value),
    consentimiento: document.getElementById("consentimiento").checked
  };

  const okEl = document.getElementById("ok");
  const errEl = document.getElementById("err");

  okEl.style.display = "none";
  errEl.style.display = "none";

  try {
    const res = await fetch("/api/solicitar-financiacion", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const json = await res.json();
    if (!res.ok) throw new Error(json.error || "Error inesperado");

    okEl.style.display = "block";
    e.target.reset();

  } catch (err) {
    errEl.textContent = "‚ùå " + err.message;
    errEl.style.display = "block";
  }
});

// ---------- INICIALIZAR ----------
renderSubcats();
renderMotos();

// Buscador: re-render en cada input
buscador.addEventListener("input", () => {
  buscadorPrimero = true;
  subcatPrimero = false;
  renderMotos();
});


// üëâ Campo tel√©fono con +54 obligatorio
const telInput = document.getElementById("telefono");

// Siempre comenzar con +54
telInput.addEventListener("focus", () => {
  if (!telInput.value.startsWith("+54")) {
    telInput.value = "+54 ";
  }
});

// Evitar borrar el +54
telInput.addEventListener("input", () => {
  if (!telInput.value.startsWith("+54")) {
    telInput.value = "+54 ";
  }
  // Quitar letras, dejar solo n√∫meros despu√©s de +54
  telInput.value = "+54 " + telInput.value.replace("+54", "").replace(/\D/g, "");
});

// Evitar borrar el prefijo con Backspace
telInput.addEventListener("keydown", (e) => {
  if (telInput.selectionStart <= 4 && (e.key === "Backspace" || e.key === "Delete")) {
    e.preventDefault();
  }
});

// üëâ Volver al Paso 1 desde el bot√≥n "1 ‚Äî Elegir moto"
document.getElementById("step1btn").addEventListener("click", () => {
  // Si ya estamos en paso 1, no hacer nada
  if (paso1.style.display !== "none") return;

  // Animaci√≥n de salida del paso 2
  paso2.classList.add("fade-out");

  setTimeout(() => {
    // Ocultar paso 2
    paso2.style.display = "none";
    paso2.classList.remove("fade-out");

    // Mostrar paso 1
    paso1.style.display = "block";
    paso1.classList.add("fade-in");

    // Mostrar subcategor√≠as y buscador nuevamente (al volver al paso 1)
    subcatsContainer.style.display = "flex";
    document.getElementById("buscador").style.display = "block";


    // Marcar visualmente los pasos
    document.getElementById("step2btn").classList.remove("active");
    document.getElementById("step1btn").classList.add("active");

    // Scroll suave arriba
    window.scrollTo({ top: 0, behavior: "smooth" });

  }, 350);
});
</script>

</body>
</html>
